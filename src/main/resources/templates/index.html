<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>FD Calculator</title>
    <style>
      :root {
        --light-blue: #95b1ee;
        --dark-blue: #364c84;
        --light-yellow: #e7f1a8;
        --pale-white: #fffdf5;
      }

      body {
        font-family: Arial, sans-serif;
        background-color: var(--pale-white);
        color: var(--dark-blue);
        margin: 0;
        padding: 15px 20px;
        /* overflow: hidden; */
        height: 100vh;
      }

      h1 {
        text-align: center;
        margin-bottom: 30px;
      }

      .container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        max-width: 1200px;
        margin: 0 auto;
        align-items: start;
      }

      form {
        padding: 30px;
        background-color: var(--light-yellow);
        border-radius: 8px;
        border: 2px solid var(--dark-blue);

        max-width: 600px;
        width: 100%;
        box-sizing: border-box;
      }

      label {
        font-weight: bold;
      }

      input,
      select {
        margin: 6px 0 15px;
        width: 100%;
        padding: 8px;
        font-size: 1rem;
      }

      button {
        padding: 10px 20px;
        font-size: 1rem;
        background-color: var(--dark-blue);
        border-radius: 5px;
        border: none;
        color: white;
        cursor: pointer;
      }

      button:hover {
        background-color: #3f599b;
      }

      .result {
        padding: 20px;
        border-radius: 8px;
        border: 2px dashed var(--dark-blue);
        background-color: var(--light-yellow);
      }

      .radio-group {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 15px;
      }

      .radio-group label {
        font-weight: normal;
      }

      .tab-btn {
        padding: 10px 20px;
        margin: 0 5px;
        font-size: 1rem;
        background-color: var(--light-blue);
        border: 1px solid var(--dark-blue);
        color: var(--dark-blue);
        cursor: pointer;
        border-radius: 5px;
      }

      .tab-btn.active {
        background-color: var(--dark-blue);
        color: white;
      }

      .highlight {
        background-color: #d0ffd0 !important;
        font-weight: bold;
      }

      @media (max-width: 768px) {
        .container {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <h1>üìà Fixed Deposit Calculator</h1>

    <div style="text-align: center; margin-bottom: 20px">
      <button
        onclick="showTab('calculator')"
        id="calculatorTab"
        class="tab-btn active"
      >
        FD Calculator
      </button>
      <button
        onclick="showTab('comparison')"
        id="comparisonTab"
        class="tab-btn"
      >
        FD Comparison
      </button>
    </div>

    <div id="calculatorSection">
      <div class="container">
        <!-- LEFT: Form -->
        <form th:action="@{/calculate}" th:object="${fdForm}" method="post">
          <input type="hidden" name="activeTab" value="calculator" />

          <label>üí∞ Principal Amount (LKR)</label>
          <input type="number" th:field="*{amount}" required />

          <label>üéØ Target Period (in months)</label>
          <input type="number" th:field="*{targetMonths}" required />

          <label>üìÖ FD Duration</label>
          <select th:field="*{fdDurationMonths}">
            <option value="1">1 month</option>
            <option value="3">3 months</option>
            <option value="6">6 months</option>
            <option value="12">12 months</option>
          </select>

          <label>üìà Interest Rate for FD Duration (%)</label>
          <input
            type="number"
            step="0.01"
            th:field="*{interestRate}"
            required
          />

          <label>‚ôªÔ∏è Renewal Type</label>
          <div class="radio-group">
            <input
              type="radio"
              th:field="*{reinvestWithInterest}"
              th:value="true"
              id="compound"
            />
            <label for="compound">With Interest (Compound)</label>
            <input
              type="radio"
              th:field="*{reinvestWithInterest}"
              th:value="false"
              id="simple"
            />
            <label for="simple">Without Interest (Simple)</label>
          </div>

          <button type="submit">üîç Calculate</button>
        </form>

        <!-- RIGHT: Results -->
        <div th:if="${result != null}" class="result">
          <h2>
            ‚úÖ Final Amount After
            <span th:text="${fdForm.targetMonths}"></span> Months
          </h2>
          <p>
            <strong
              th:text="${#numbers.formatDecimal(result, 0, 'COMMA', 2, 'POINT')} + ' LKR'"
            ></strong>
          </p>
        </div>
      </div>
    </div>

    <div id="comparisonSection" style="display: none">
      <div class="container">
        <form th:action="@{/compare}" method="post">
          <input type="hidden" name="activeTab" value="comparison" />

          <label>üéØ Target Period (in months)</label>
          <input type="number" name="targetMonths" required />

          <div id="comparisonInputs">
            <div class="compare-row">
              <label>üí∞ Principal Amount (LKR)</label>
              <input type="number" name="principals" required />

              <label>üìÖ FD Duration (in months)</label>
              <input type="number" name="durations" required />

              <label>üìà Interest Rate (%)</label>
              <input type="number" step="0.01" name="rates" required />
            </div>
          </div>

          <button type="button" onclick="addFDRow()">
            ‚ûï Add Another Option
          </button>
          <br /><br />
          <button type="submit">üìä Compare</button>
        </form>

        <div th:if="${comparisonResults != null}">
          <h2>üìà Comparison Table</h2>
          <table border="1" cellpadding="8" cellspacing="0" style="width: 100%">
            <thead>
              <tr>
                <th>Principal</th>
                <th>FD Duration</th>
                <th>Interest Rate</th>
                <th>Final Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr
                th:each="res : ${comparisonResults}"
                th:classappend="${res.finalAmount.equals(maxFinalAmount)} ? 'highlight'"
              >
                <td th:text="${res.principal} + ' LKR'"></td>
                <td th:text="${res.duration} + ' months'"></td>
                <td th:text="${res.rate} + '%'"></td>
                <td
                  th:text="${#numbers.formatDecimal(res.finalAmount, 0, 'COMMA', 2, 'POINT')} + ' LKR'"
                ></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script th:inline="javascript">
      function showTab(tab) {
        const calcTab = document.getElementById("calculatorTab");
        const compTab = document.getElementById("comparisonTab");

        const calcSection = document.getElementById("calculatorSection");
        const compSection = document.getElementById("comparisonSection");

        if (tab === "calculator") {
          calcSection.style.display = "block";
          compSection.style.display = "none";
          calcTab.classList.add("active");
          compTab.classList.remove("active");
        } else {
          calcSection.style.display = "none";
          compSection.style.display = "block";
          compTab.classList.add("active");
          calcTab.classList.remove("active");
        }
      }

      // ‚úÖ Automatically activate the correct tab after reload
      window.onload = function () {
        const activeTab = /*[[${activeTab}]]*/ "calculator";

        showTab(activeTab);
      };

      function addFDRow() {
        const container = document.getElementById("comparisonInputs");

        const row = document.createElement("div");
        row.classList.add("compare-row");

        row.innerHTML = `
      <label>üí∞ Principal Amount (LKR)</label>
      <input type="number" name="principals" required />

      <label>üìÖ FD Duration (in months)</label>
      <input type="number" name="durations" required />

      <label>üìà Interest Rate (%)</label>
      <input type="number" step="0.01" name="rates" required />
    `;

        container.appendChild(row);
      }
    </script>
  </body>
</html>
